{% extends "base.html" %}

{% block title %}Member Dashboard - FitZone Gym{% endblock %}

{% block content %}
<style>
    body {
        background-color: #f9fafb;
        font-family: 'Poppins', sans-serif;
    }

    h1, h2 {
        color: #111827;
    }

    .card {
        background: #fff;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease-in-out;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    }

    .card-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #f3f4f6;
    }

    .card-body {
        padding: 1.25rem;
    }

    .stat-card {
        background: #fff;
        border-radius: 12px;
        padding: 1.25rem;
        border: 1px solid #e5e7eb;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: 0.2s ease-in-out;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.1);
    }

    .stat-label {
        font-size: 0.9rem;
        color: #6b7280;
        font-weight: 500;
    }

    .stat-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: #111827;
    }

    .text-primary {
        color: #2563eb;
    }

    .text-accent {
        color: #f97316;
    }

    .text-secondary {
        color: #6b7280;
    }

    .btn {
        display: inline-block;
        padding: 0.7rem 1rem;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: 0.2s ease-in-out;
        text-align: center;
    }

    .btn-primary {
        background-color: #2563eb;
        color: #fff;
    }

    .btn-primary:hover {
        background-color: #1d4ed8;
    }

    .btn-secondary {
        background-color: #6b7280;
        color: #fff;
    }

    .btn-secondary:hover {
        background-color: #4b5563;
    }

    .alert {
        padding: 1rem 1.25rem;
        border-radius: 8px;
        font-weight: 500;
    }

    .alert-danger {
        background: #fee2e2;
        border: 1px solid #ef4444;
        color: #991b1b;
    }

    .alert-warning {
        background: #fff7ed;
        border: 1px solid #f59e0b;
        color: #92400e;
    }

    .badge {
        padding: 0.3rem 0.6rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: capitalize;
    }

    .badge-success {
        background-color: #dcfce7;
        color: #166534;
    }

    .badge-danger {
        background-color: #fee2e2;
        color: #991b1b;
    }

    .badge-info {
        background-color: #dbeafe;
        color: #1e3a8a;
    }

    .badge-warning {
        background-color: #fef3c7;
        color: #92400e;
    }

    a.text-primary:hover {
        text-decoration: underline;
    }
</style>

<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
        <i class="fas fa-user mr-3 text-primary"></i>Welcome, {{ member.full_name }}
    </h1>
    <p class="text-gray-600">Track your fitness journey and manage your membership</p>
</div>

<!-- Alert Messages -->
{% if alert_message %}
<div class="alert {% if 'pending payment' in alert_message.lower() or 'expired' in alert_message.lower() %}alert-danger{% else %}alert-warning{% endif %} mb-6">
    {{ alert_message|safe }}

    {% if stats.pending_payments %}
        <ul class="mt-2 text-sm list-disc pl-6">
            {% for p in stats.pending_payments %}
                <li class="{% if p.is_overdue %}text-red-600 font-bold{% endif %}">
                    <i class="fas fa-clock mr-1 {% if p.is_overdue %}text-red-600{% else %}text-yellow-500{% endif %}"></i>
                    Payment of â‚¹{{ p.amount }} 
                    {% if p.due_date_obj %}
                        is due by {{ p.due_date_obj.strftime('%B %d, %Y') }}
                    {% else %}
                        (No due date set)
                    {% endif %}
                    {% if p.is_overdue %}(Overdue){% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
</div>
{% endif %}

<!-- Stats Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Membership Status -->
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Membership Status</div>
                <div class="stat-value {{ 'text-green-600' if stats.membership_status == 'active' else 'text-red-600' }}">
                    {{ stats.membership_status|title }}
                </div>
            </div>
            <i class="fas fa-id-card text-primary text-2xl"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Days Until Expiry</div>
                <div class="stat-value {{ 'text-green-600' if stats.days_until_expiry > 30 else 'text-yellow-600' if stats.days_until_expiry > 7 else 'text-red-600' }}">
                    {{ stats.days_until_expiry }}
                </div>
            </div>
            <i class="fas fa-calendar text-accent text-2xl"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Recent Sessions</div>
                <div class="stat-value">{{ stats.recent_attendance|length }}</div>
            </div>
            <i class="fas fa-dumbbell text-secondary text-2xl"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Pending Payments</div>
                <div class="stat-value {{ 'text-red-600' if stats.pending_payments else 'text-green-600' }}">
                    {{ stats.pending_payments|length }}
                </div>
            </div>
            <i class="fas fa-credit-card text-yellow-500 text-2xl"></i>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <a href="{{ url_for('member.profile') }}" class="btn btn-primary">
        <i class="fas fa-user-edit block mb-1"></i>Edit Profile
    </a>
    <a href="{{ url_for('member.workouts') }}" class="btn btn-secondary">
        <i class="fas fa-dumbbell block mb-1"></i>My Workouts
    </a>
    <a href="{{ url_for('member.schedule_session') }}" 
       class="btn bg-orange-500 text-white hover:bg-orange-600 {% if stats.membership_status != 'active' %}opacity-50 cursor-not-allowed pointer-events-none{% endif %}">
        <i class="fas fa-calendar-plus block mb-1"></i>Book Session
    </a>
    <a href="{{ url_for('member.membership_status') }}" class="btn bg-purple-600 text-white hover:bg-purple-700">
        <i class="fas fa-id-card block mb-1"></i>Membership
    </a>
</div>


<!-- Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Recent Attendance -->
    <div class="card">
        <div class="card-header flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">Recent Attendance</h2>
            <a href="{{ url_for('member.attendance') }}" class="text-primary hover:underline text-sm">View All</a>
        </div>
        <div class="card-body p-0">
            {% if stats.recent_attendance %}
            <div class="divide-y divide-gray-200">
                {% for attendance in stats.recent_attendance %}
                <div class="p-4 hover:bg-gray-50 transition">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-900">
                                {{ attendance.date|default("")|datetimeformat('%B %d, %Y') }}
                            </div>
                            <div class="text-sm text-gray-500">{{ attendance.time_slot }}</div>
                        </div>
                        <div class="badge badge-{{ 'success' if attendance.status == 'present' else 'danger' }}">
                            {{ attendance.status|title }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="p-4 text-center text-gray-500">No recent attendance records</div>
            {% endif %}
        </div>
    </div>

    <!-- Latest Progress -->
    <div class="card">
        <div class="card-header flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">Latest Progress</h2>
            <a href="{{ url_for('member.progress') }}" class="text-primary hover:underline text-sm">View All</a>
        </div>
        <div class="card-body">
            {% if latest_progress %}
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Weight</span>
                    <span class="font-medium">{{ latest_progress.weight }}kg</span>
                </div>
                {% if latest_progress.bmi %}
                <div class="flex justify-between">
                    <span class="text-gray-600">BMI</span>
                    <span class="font-medium">{{ latest_progress.bmi }}</span>
                </div>
                {% endif %}
                {% if latest_progress.body_fat_percentage %}
                <div class="flex justify-between">
                    <span class="text-gray-600">Body Fat</span>
                    <span class="font-medium">{{ latest_progress.body_fat_percentage }}%</span>
                </div>
                {% endif %}
                <div class="text-sm text-gray-500 mt-3">
                    Recorded on {{ latest_progress.recorded_date|default("")|datetimeformat('%B %d, %Y') }}
                </div>
            </div>
            {% else %}
            <div class="text-center text-gray-500">
                <i class="fas fa-chart-line text-gray-400 text-3xl mb-2"></i>
                <p>No progress data yet</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Announcements -->
{% if announcements %}
<div class="card">
    <div class="card-header flex items-center">
        <i class="fas fa-bullhorn mr-2 text-accent"></i>
        <h2 class="text-xl font-semibold text-gray-900">Latest Announcements</h2>
    </div>
    <div class="card-body p-0">
        <div class="divide-y divide-gray-200">
            {% for announcement in announcements %}
            <div class="p-4 hover:bg-gray-50 transition">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-medium text-gray-900">{{ announcement.title }}</h3>
                        <p class="text-sm text-gray-600 mt-1">
                            {{ announcement.content|truncate(100, True, '...') }}
                        </p>
                        <div class="text-xs text-gray-500 mt-2">
                            {{ announcement.created_at|datetimeformat }}
                        </div>
                    </div>
                    <span class="badge badge-info">{{ announcement.announcement_type|title }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
