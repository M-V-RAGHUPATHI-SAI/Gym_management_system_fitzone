{% extends "base.html" %}

{% block title %}Member Dashboard - FitZone Gym{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">
        <i class="fas fa-user mr-3 text-primary"></i>Welcome, {{ member.full_name }}
    </h1>
    <p class="text-gray-600">Track your fitness journey and manage your membership</p>
</div>

<!-- Alert Messages -->
{% if alert_message %}
<div class="alert {% if 'pending payment' in alert_message.lower() or 'expired' in alert_message.lower() %}alert-danger{% else %}alert-warning{% endif %} mb-6">
    {{ alert_message|safe }}

    {% if stats.pending_payments %}
        <ul class="mt-2 text-sm">
            {% for p in stats.pending_payments %}
                <li class="{% if p.is_overdue %}text-red-600 font-bold{% endif %}">
                    <i class="fas fa-clock mr-1 {% if p.is_overdue %}text-red-600{% else %}text-yellow-500{% endif %}"></i>
                    Payment of â‚¹{{ p.amount }} 
                    {% if p.due_date_obj %}
                        is due by {{ p.due_date_obj.strftime('%B %d, %Y') }}
                    {% else %}
                        (No due date set)
                    {% endif %}
                    {% if p.is_overdue %}(Overdue){% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
</div>
{% endif %}

<!-- Quick Actions -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <a href="{{ url_for('member.profile') }}" class="btn btn-primary text-center">
        <i class="fas fa-user-edit block mb-1"></i>Edit Profile
    </a>
    <a href="{{ url_for('member.workouts') }}" class="btn btn-secondary text-center">
        <i class="fas fa-dumbbell block mb-1"></i>My Workouts
    </a>
    <a href="{{ url_for('member.schedule_session') }}" 
       class="btn bg-accent text-white hover:bg-orange-600 text-center {% if stats.membership_status != 'active' %}opacity-50 cursor-not-allowed pointer-events-none{% endif %}">
        <i class="fas fa-calendar-plus block mb-1"></i>Book Session
    </a>
    <a href="{{ url_for('member.membership_status') }}" class="btn bg-purple-600 text-white hover:bg-purple-700 text-center">
        <i class="fas fa-id-card block mb-1"></i>Membership
    </a>
</div>

<!-- Membership Status -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Membership Status</div>
                <div class="stat-value text-sm {{ 'text-success' if stats.membership_status == 'active' else 'text-danger' }}">
                    {{ stats.membership_status|title }}
                </div>
            </div>
            <i class="fas fa-id-card text-primary text-2xl"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Days Until Expiry</div>
                <div class="stat-value text-lg {{ 'text-success' if stats.days_until_expiry > 30 else 'text-warning' if stats.days_until_expiry > 7 else 'text-danger' }}">
                    {{ stats.days_until_expiry }}
                </div>
            </div>
            <i class="fas fa-calendar text-accent text-2xl"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Recent Sessions</div>
                <div class="stat-value text-lg">{{ stats.recent_attendance|length }}</div>
            </div>
            <i class="fas fa-dumbbell text-secondary text-2xl"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="flex items-center justify-between">
            <div>
                <div class="stat-label">Pending Payments</div>
                <div class="stat-value text-lg {{ 'text-danger' if stats.pending_payments else 'text-success' }}">
                    {{ stats.pending_payments|length }}
                </div>
            </div>
            <i class="fas fa-credit-card text-warning text-2xl"></i>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Recent Attendance -->
    <div class="card">
        <div class="card-header flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">Recent Attendance</h2>
            <a href="{{ url_for('member.attendance') }}" class="text-primary hover:underline text-sm">View All</a>
        </div>
        <div class="card-body p-0">
            {% if stats.recent_attendance %}
            <div class="divide-y divide-gray-200">
                {% for attendance in stats.recent_attendance %}
                <div class="p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-900">
                                {{ attendance.date|default("")|datetimeformat('%B %d, %Y') }}
                            </div>
                            <div class="text-sm text-gray-500">{{ attendance.time_slot }}</div>
                        </div>
                        <div class="badge badge-{{ 'success' if attendance.status == 'present' else 'danger' }}">
                            {{ attendance.status|title }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="p-4 text-center text-gray-500">No recent attendance records</div>
            {% endif %}
        </div>
    </div>

    <!-- Latest Progress -->
    <div class="card">
        <div class="card-header flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">Latest Progress</h2>
            <a href="{{ url_for('member.progress') }}" class="text-primary hover:underline text-sm">View All</a>
        </div>
        <div class="card-body">
            {% if latest_progress %}
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Weight</span>
                    <span class="font-medium">{{ latest_progress.weight }}kg</span>
                </div>
                {% if latest_progress.bmi %}
                <div class="flex justify-between">
                    <span class="text-gray-600">BMI</span>
                    <span class="font-medium">{{ latest_progress.bmi }}</span>
                </div>
                {% endif %}
                {% if latest_progress.body_fat_percentage %}
                <div class="flex justify-between">
                    <span class="text-gray-600">Body Fat</span>
                    <span class="font-medium">{{ latest_progress.body_fat_percentage }}%</span>
                </div>
                {% endif %}
                <div class="text-sm text-gray-500 mt-3">
                    Recorded on {{ latest_progress.recorded_date|default("")|datetimeformat('%B %d, %Y') }}
                </div>
            </div>
            {% else %}
            <div class="text-center text-gray-500">
                <i class="fas fa-chart-line text-gray-400 text-3xl mb-2"></i>
                <p>No progress data yet</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Announcements -->
{% if announcements %}
<div class="card">
    <div class="card-header">
        <h2 class="text-xl font-semibold text-gray-900">
            <i class="fas fa-bullhorn mr-2 text-accent"></i>Latest Announcements
        </h2>
    </div>
    <div class="card-body p-0">
        <div class="divide-y divide-gray-200">
            {% for announcement in announcements %}
            <div class="p-4 hover:bg-gray-50">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-medium text-gray-900">{{ announcement.title }}</h3>
                        <p class="text-sm text-gray-600 mt-1">
                            {{ announcement.content|truncate(100, True, '...') }}
                        </p>
                        <div class="text-xs text-gray-500 mt-2">
                            {{ announcement.created_at|datetimeformat }}
                        </div>
                    </div>
                    <span class="badge badge-info text-xs">{{ announcement.announcement_type|title }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
