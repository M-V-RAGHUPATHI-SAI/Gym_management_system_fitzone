{% extends "base.html" %}
{% block title %}Client Details - Trainer{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-user mr-3 text-primary"></i>{{ member.full_name }}
        </h1>
        <nav class="text-sm text-gray-500 mt-2">
            <a href="{{ url_for('trainer_routes.dashboard') }}" class="hover:text-gray-700">Dashboard</a>
            <span class="mx-2">/</span>
            <a href="{{ url_for('trainer_routes.clients') }}" class="hover:text-gray-700">Clients</a>
            <span class="mx-2">/</span>
            <span>{{ member.full_name }}</span>
        </nav>
    </div>

    <!-- Overview Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-2xl shadow-md p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500">Status</p>
                    <p class="font-semibold text-lg {{ 'text-green-600' if member.status == 'active' else 'text-yellow-600' }}">{{ member.status|title }}</p>
                </div>
                <i class="fas fa-user text-primary text-2xl"></i>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-md p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500">Current Weight</p>
                    <p class="font-semibold text-lg">{{ member.weight or 'N/A' }}{% if member.weight %} kg{% endif %}</p>
                </div>
                <i class="fas fa-weight text-blue-500 text-2xl"></i>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-md p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500">Attendance</p>
                    <p class="font-semibold text-lg">{{ attendance_records|length }} sessions</p>
                </div>
                <i class="fas fa-calendar-check text-indigo-500 text-2xl"></i>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-md p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500">Progress Records</p>
                    <p class="font-semibold text-lg">{{ progress_records|length }} entries</p>
                </div>
                <i class="fas fa-chart-line text-green-600 text-2xl"></i>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-2xl shadow-md p-6 mb-10">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Actions</h2>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <a href="{{ url_for('trainer_routes.create_workout_plan', member_id=member.id) }}" 
               class="flex flex-col items-center justify-center bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium rounded-xl p-4 transition shadow-sm">
                <i class="fas fa-dumbbell text-2xl mb-2"></i>
                Create Workout
            </a>

            <a href="{{ url_for('trainer_routes.create_diet_plan', member_id=member.id) }}" 
               class="flex flex-col items-center justify-center bg-green-100 hover:bg-green-200 text-green-700 font-medium rounded-xl p-4 transition shadow-sm">
                <i class="fas fa-apple-alt text-2xl mb-2"></i>
                Create Diet
            </a>

            <a href="{{ url_for('trainer_routes.record_progress', member_id=member.id) }}" 
               class="flex flex-col items-center justify-center bg-orange-100 hover:bg-orange-200 text-orange-700 font-medium rounded-xl p-4 transition shadow-sm">
                <i class="fas fa-chart-line text-2xl mb-2"></i>
                Record Progress
            </a>

            <form method="POST" action="{{ url_for('trainer_routes.mark_attendance', member_id=member.id) }}" class="inline w-full">
                <button type="submit" 
                    class="w-full flex flex-col items-center justify-center bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium rounded-xl p-4 transition shadow-sm">
                    <i class="fas fa-check-circle text-2xl mb-2"></i>
                    Mark Present
                </button>
            </form>

            <button onclick="showContactInfo()" 
                    class="flex flex-col items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl p-4 transition shadow-sm">
                <i class="fas fa-phone text-2xl mb-2"></i>
                Contact Info
            </button>
        </div>
    </div>

    <!-- Current Plans Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
        <!-- Workout Plan -->
        <div class="bg-white rounded-2xl shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Current Workout Plan</h3>
                {% if current_workout_plan %}
                <a href="{{ url_for('trainer_routes.edit_workout_plan', plan_id=current_workout_plan.id) }}" 
                   class="text-primary text-sm hover:underline">Edit Plan</a>
                {% endif %}
            </div>
            {% if current_workout_plan %}
            <div>
                <p class="font-medium text-gray-900">{{ current_workout_plan.name }}</p>
                {% if current_workout_plan.description %}
                <p class="text-gray-600 text-sm mt-1">{{ current_workout_plan.description }}</p>
                {% endif %}
                <p class="text-gray-500 text-sm mt-2">
                    {{ current_workout_plan.start_date|datetimeformat('%b %d, %Y') }} -
                    {{ current_workout_plan.end_date|datetimeformat('%b %d, %Y') if current_workout_plan.end_date else 'Ongoing' }}
                </p>
                <span class="inline-block mt-3 px-2 py-1 rounded-full text-xs font-medium 
                    {% if current_workout_plan.status == 'active' %}bg-green-100 text-green-700{% else %}bg-yellow-100 text-yellow-700{% endif %}">
                    {{ current_workout_plan.status|title }}
                </span>
            </div>
            {% else %}
            <div class="text-center py-8">
                <i class="fas fa-dumbbell text-gray-400 text-3xl mb-2"></i>
                <p class="text-gray-500">No active workout plan</p>
                <a href="{{ url_for('trainer_routes.create_workout_plan', member_id=member.id) }}" class="btn btn-primary mt-3">Create Workout Plan</a>
            </div>
            {% endif %}
        </div>

        <!-- Diet Plan -->
        <div class="bg-white rounded-2xl shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Current Diet Plan</h3>
                {% if current_diet_plan %}
                <a href="{{ url_for('trainer_routes.edit_diet_plan', plan_id=current_diet_plan.id) }}" 
                   class="text-primary text-sm hover:underline">Edit Plan</a>
                {% endif %}
            </div>
            {% if current_diet_plan %}
            <div>
                <p class="font-medium text-gray-900">{{ current_diet_plan.name }}</p>
                {% if current_diet_plan.description %}
                <p class="text-gray-600 text-sm mt-1">{{ current_diet_plan.description }}</p>
                {% endif %}
                {% if current_diet_plan.total_calories %}
                <p class="text-gray-500 text-sm mt-1">Target: {{ current_diet_plan.total_calories }} cal/day</p>
                {% endif %}
                <p class="text-gray-500 text-sm mt-2">
                    {{ current_diet_plan.start_date|datetimeformat('%b %d, %Y') }} -
                    {{ current_diet_plan.end_date|datetimeformat('%b %d, %Y') if current_diet_plan.end_date else 'Ongoing' }}
                </p>
                <span class="inline-block mt-3 px-2 py-1 rounded-full text-xs font-medium 
                    {% if current_diet_plan.status == 'active' %}bg-green-100 text-green-700{% else %}bg-yellow-100 text-yellow-700{% endif %}">
                    {{ current_diet_plan.status|title }}
                </span>
            </div>
            {% else %}
            <div class="text-center py-8">
                <i class="fas fa-apple-alt text-gray-400 text-3xl mb-2"></i>
                <p class="text-gray-500">No active diet plan</p>
                <a href="{{ url_for('trainer_routes.create_diet_plan', member_id=member.id) }}" class="btn btn-secondary mt-3">Create Diet Plan</a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- History Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Attendance History -->
        <div class="bg-white rounded-2xl shadow-md p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Recent Attendance</h3>
            {% if attendance_records %}
            <div class="space-y-3">
                {% for record in attendance_records %}
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg hover:bg-blue-50 transition">
                    <div>
                        <p class="font-medium text-gray-900">{{ record.date|datetimeformat('%B %d, %Y') }}</p>
                        <p class="text-sm text-gray-500">{{ record.time_slot }}</p>
                    </div>
                    <span class="px-2 py-1 text-xs rounded-full font-medium
                        {% if record.status == 'present' %}bg-green-100 text-green-700
                        {% elif record.status == 'absent' %}bg-red-100 text-red-700
                        {% else %}bg-yellow-100 text-yellow-700{% endif %}">
                        {{ record.status|title }}
                    </span>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center text-gray-500 py-6">No attendance records</div>
            {% endif %}
        </div>

        <!-- Progress History -->
        <div class="bg-white rounded-2xl shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Progress History</h3>
                <a href="{{ url_for('trainer_routes.record_progress', member_id=member.id) }}" class="text-primary hover:underline text-sm">Record New</a>
            </div>
            {% if progress_records %}
            <div class="space-y-3">
                {% for progress in progress_records %}
                <div class="bg-gray-50 p-3 rounded-lg hover:bg-blue-50 transition">
                    <p class="font-medium text-gray-900">{{ progress.recorded_date|datetimeformat('%B %d, %Y')}}</p>
                    <div class="grid grid-cols-2 gap-2 text-sm text-gray-600 mt-1">
                        {% if progress.weight %}<div>Weight: {{ progress.weight }}kg</div>{% endif %}
                        {% if progress.bmi %}<div>BMI: {{ progress.bmi }}</div>{% endif %}
                        {% if progress.body_fat_percentage %}<div>Body Fat: {{ progress.body_fat_percentage }}%</div>{% endif %}
                        {% if progress.chest %}<div>Chest: {{ progress.chest }}cm</div>{% endif %}
                    </div>
                    {% if progress.notes %}
                    <p class="text-xs text-gray-500 mt-2">{{ progress.notes }}</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center text-gray-500 py-6">No progress records</div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Contact Info Modal -->
<div id="contactModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Contact Information</h3>
        <div class="space-y-3">
            <div><label class="text-sm text-gray-500">Email</label><div class="font-medium">{{ member.email }}</div></div>
            <div><label class="text-sm text-gray-500">Phone</label><div class="font-medium">{{ member.phone }}</div></div>
            {% if member.emergency_contact %}
            <div><label class="text-sm text-gray-500">Emergency Contact</label><div class="font-medium">{{ member.emergency_contact }}</div></div>
            {% endif %}
            {% if member.emergency_phone %}
            <div><label class="text-sm text-gray-500">Emergency Phone</label><div class="font-medium">{{ member.emergency_phone }}</div></div>
            {% endif %}
        </div>
        <div class="mt-6 text-right">
            <button onclick="hideContactInfo()" class="btn btn-secondary">Close</button>
        </div>
    </div>
</div>

<script>
function showContactInfo() {
    document.getElementById('contactModal').classList.remove('hidden');
}
function hideContactInfo() {
    document.getElementById('contactModal').classList.add('hidden');
}
</script>
{% endblock %}
