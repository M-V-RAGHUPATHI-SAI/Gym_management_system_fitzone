{% extends "base.html" %}

{% block title %}Reports - Admin{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">

    <!-- Header with Back Arrow -->
    <div class="flex items-center mb-8">
        <button onclick="window.location.href='{{ url_for('admin.dashboard') }}'"
            class="flex items-center justify-center w-10 h-10 bg-blue-100 text-blue-600 rounded-full shadow hover:bg-blue-200 transition duration-200">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div class="ml-4">
            <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-chart-bar text-blue-600 mr-3"></i>Reports & Analytics
            </h1>
            <p class="text-gray-600">View comprehensive gym insights and performance analytics</p>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <!-- Member Statistics -->
        <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-users text-blue-500 mr-2"></i>Member Statistics
            </h3>
            {% if member_stats %}
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Members</span>
                    <span class="font-semibold">{{ member_stats.total_members or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Members</span>
                    <span class="font-semibold text-green-600">{{ member_stats.total_active or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Inactive Members</span>
                    <span class="font-semibold text-yellow-500">{{ member_stats.inactive_members or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">New This Month</span>
                    <span class="font-semibold text-blue-600">{{ member_stats.new_this_month or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Expiring Next 7 Days</span>
                    <span class="font-semibold text-red-500">{{ member_stats.expiring_next_7_days or 0 }}</span>
                </div>
            </div>
            {% else %}
            <p class="text-gray-500">No member data available</p>
            {% endif %}
        </div>

        <!-- Revenue Statistics -->
        <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-rupee-sign text-blue-500 mr-2"></i>Revenue Statistics
            </h3>
            {% if revenue_stats %}
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Revenue</span>
                    <span class="font-semibold text-green-600">₹{{ revenue_stats.total_revenue or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">This Month</span>
                    <span class="font-semibold text-blue-600">₹{{ revenue_stats.monthly_revenue or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Pending Payments</span>
                    <span class="font-semibold text-yellow-500">₹{{ revenue_stats.pending_amount or 0 }}</span>
                </div>
            </div>
            {% else %}
            <p class="text-gray-500">No revenue data available</p>
            {% endif %}
        </div>

        <!-- Attendance Statistics -->
        <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-calendar-check text-blue-500 mr-2"></i>Attendance Statistics
            </h3>
            {% if attendance_stats %}
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Sessions</span>
                    <span class="font-semibold">{{ attendance_stats.total_sessions or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Present</span>
                    <span class="font-semibold text-green-600">{{ attendance_stats.present or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Attendance Rate</span>
                    <span class="font-semibold text-blue-600">{{ attendance_stats.attendance_rate or 0 }}%</span>
                </div>
            </div>
            {% else %}
            <p class="text-gray-500">No attendance data available</p>
            {% endif %}
        </div>
    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Revenue Chart -->
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-line text-blue-500 mr-2"></i>Monthly Revenue Trend
            </h3>
            <canvas id="revenueChart" class="h-64"></canvas>
        </div>

        <!-- Attendance Chart -->
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-bar text-blue-500 mr-2"></i>Daily Attendance Trend
            </h3>
            <canvas id="attendanceChart" class="h-64"></canvas>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: {{ revenue_labels|safe if revenue_labels else '[]' }},
            datasets: [{
                label: 'Revenue',
                data: {{ revenue_data|safe if revenue_data else '[]' }},
                borderColor: '#2563eb',
                backgroundColor: 'rgba(37, 99, 235, 0.2)',
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });

    // Attendance Chart
    const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
    new Chart(attendanceCtx, {
        type: 'bar',
        data: {
            labels: {{ attendance_labels|safe if attendance_labels else '[]' }},
            datasets: [{
                label: 'Attendance',
                data: {{ attendance_data|safe if attendance_data else '[]' }},
                backgroundColor: 'rgba(59, 130, 246, 0.6)',
                borderRadius: 6
            }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });
</script>
{% endblock %}
