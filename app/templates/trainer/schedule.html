{% extends "base.html" %}

{% block title %}My Schedule - Trainer{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-calendar text-primary mr-3"></i>My Schedule
        </h1>
        <p class="text-gray-600">View and manage your training sessions for the selected date</p>
    </div>

    <!-- Date Selection Card -->
    <div class="card bg-white shadow-md rounded-2xl border border-gray-100 mb-8">
        <div class="card-body p-6">
            <form method="GET" action="{{ url_for('trainer_routes.schedule') }}" class="flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="form-label font-medium text-gray-700">Select Date</label>
                    <input type="date" id="date" name="date"
                           value="{{ selected_date.strftime('%Y-%m-%d') }}"
                           class="form-control">
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search mr-2"></i>View
                    </button>
                    <a href="{{ url_for('trainer_routes.schedule', date=date.today().strftime('%Y-%m-%d')) }}" 
                       class="btn btn-secondary">
                        <i class="fas fa-calendar-day mr-2"></i>Today
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Display Card -->
    <div class="card bg-white shadow-md rounded-2xl border border-gray-100">
        <div class="card-header px-6 py-4 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-900">
                Schedule for {{ selected_date.strftime('%A, %B %d, %Y') }}
            </h2>
        </div>

        <div class="card-body p-6">
            {% if schedule %}
                <div class="space-y-6">
                    {% for session in schedule %}
                    <div class="rounded-xl border border-gray-100 p-5 shadow-sm hover:shadow-md transition bg-white">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                            <div>
                                <div class="text-sm text-gray-500 mb-1">Time Slot</div>
                                <div class="text-lg font-semibold text-gray-900">{{ session.time_slot }}</div>
                            </div>

                            {% if session.member_name %}
                            <div>
                                <div class="text-sm text-gray-500 mb-1">Client</div>
                                <div class="font-medium text-gray-800">{{ session.member_name }}</div>
                                {% if session.member_phone %}
                                <div class="text-sm text-gray-500">{{ session.member_phone }}</div>
                                {% endif %}
                            </div>
                            {% else %}
                            <div class="text-gray-400 italic">Available Slot</div>
                            {% endif %}
                        </div>

                        {% if session.notes %}
                        <div class="mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3">
                            <strong>Notes:</strong> {{ session.notes }}
                        </div>
                        {% endif %}

                        <div class="mt-4 flex flex-wrap gap-3 justify-end">
                            {% if session.member_id %}
                                {% if session.status == 'scheduled' %}
                                <form method="POST" action="{{ url_for('trainer_routes.mark_attendance', member_id=session.member_id) }}">
                                    <input type="hidden" name="date" value="{{ selected_date.strftime('%Y-%m-%d') }}">
                                    <input type="hidden" name="time_slot" value="{{ session.time_slot }}">
                                    <input type="hidden" name="status" value="present">
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-check mr-2"></i>Mark Present
                                    </button>
                                </form>

                                <form method="POST" action="{{ url_for('trainer_routes.mark_attendance', member_id=session.member_id) }}">
                                    <input type="hidden" name="date" value="{{ selected_date.strftime('%Y-%m-%d') }}">
                                    <input type="hidden" name="time_slot" value="{{ session.time_slot }}">
                                    <input type="hidden" name="status" value="absent">
                                    <button type="submit" class="btn btn-danger">
                                        <i class="fas fa-times mr-2"></i>Mark Absent
                                    </button>
                                </form>
                                {% endif %}

                                <a href="{{ url_for('trainer_routes.client_details', member_id=session.member_id) }}" 
                                   class="btn btn-info">
                                    <i class="fas fa-user mr-2"></i>View Client
                                </a>
                            {% else %}
                            <button class="btn btn-secondary cursor-default opacity-70">
                                <i class="fas fa-clock mr-2"></i>No Booking
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-calendar text-gray-400 text-5xl mb-4"></i>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">No Sessions Scheduled</h3>
                    <p class="text-gray-500 mb-6">There are no training sessions for this date.</p>
                    <a href="{{ url_for('trainer_routes.dashboard') }}" class="btn btn-primary">
                        <i class="fas fa-home mr-2"></i>Back to Dashboard
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Navigation -->
    <div class="mt-8 text-center">
        <div class="space-x-4">
            <a href="{{ url_for('trainer_routes.schedule', date=(selected_date - timedelta(days=1)).strftime('%Y-%m-%d')) }}" 
               class="btn btn-secondary">
                <i class="fas fa-chevron-left mr-2"></i>Previous Day
            </a>
            <a href="{{ url_for('trainer_routes.schedule', date=(selected_date + timedelta(days=1)).strftime('%Y-%m-%d')) }}" 
               class="btn btn-secondary">
                Next Day<i class="fas fa-chevron-right ml-2"></i>
            </a>
        </div>
    </div>
</div>
{% endblock %}
